{"ast":null,"code":"\"use strict\"; // utility for whatwg streams\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ensureAsyncIterable = exports.asyncIterableFromStream = exports.isAsyncIterable = void 0;\n\nfunction isAsyncIterable(object) {\n  return object[Symbol.asyncIterator] != null;\n}\n\nexports.isAsyncIterable = isAsyncIterable;\n\nfunction assertNonNull(value) {\n  if (value == null) {\n    throw new Error(\"Assertion Failure: value must not be null nor undefined\");\n  }\n}\n\nasync function* asyncIterableFromStream(stream) {\n  const reader = stream.getReader();\n\n  try {\n    while (true) {\n      const {\n        done,\n        value\n      } = await reader.read();\n\n      if (done) {\n        return;\n      }\n\n      assertNonNull(value);\n      yield value;\n    }\n  } finally {\n    reader.releaseLock();\n  }\n}\n\nexports.asyncIterableFromStream = asyncIterableFromStream;\n\nfunction ensureAsyncIterable(streamLike) {\n  if (isAsyncIterable(streamLike)) {\n    return streamLike;\n  } else {\n    return asyncIterableFromStream(streamLike);\n  }\n}\n\nexports.ensureAsyncIterable = ensureAsyncIterable;","map":{"version":3,"sources":["../../src/utils/stream.ts"],"names":[],"mappings":"cAAA;;;;;;;AAQA,SAAgB,eAAhB,CAAmC,MAAnC,EAAgE;AAC9D,SAAQ,MAAc,CAAC,MAAM,CAAC,aAAR,CAAd,IAAwC,IAAhD;AACD;;AAFD,OAAA,CAAA,eAAA,GAAA,eAAA;;AAIA,SAAS,aAAT,CAA0B,KAA1B,EAAqD;AACnD,MAAI,KAAK,IAAI,IAAb,EAAmB;AACjB,UAAM,IAAI,KAAJ,CAAU,yDAAV,CAAN;AACD;AACF;;AAEM,gBAAgB,uBAAhB,CAA2C,MAA3C,EAAoE;AACzE,QAAM,MAAM,GAAG,MAAM,CAAC,SAAP,EAAf;;AAEA,MAAI;AACF,WAAO,IAAP,EAAa;AACX,YAAM;AAAE,QAAA,IAAF;AAAQ,QAAA;AAAR,UAAkB,MAAM,MAAM,CAAC,IAAP,EAA9B;;AACA,UAAI,IAAJ,EAAU;AACR;AACD;;AACD,MAAA,aAAa,CAAC,KAAD,CAAb;AACA,YAAM,KAAN;AACD;AACF,GATD,SASU;AACR,IAAA,MAAM,CAAC,WAAP;AACD;AACF;;AAfD,OAAA,CAAA,uBAAA,GAAA,uBAAA;;AAiBA,SAAgB,mBAAhB,CAAuC,UAAvC,EAAwE;AACtE,MAAI,eAAe,CAAC,UAAD,CAAnB,EAAiC;AAC/B,WAAO,UAAP;AACD,GAFD,MAEO;AACL,WAAO,uBAAuB,CAAC,UAAD,CAA9B;AACD;AACF;;AAND,OAAA,CAAA,mBAAA,GAAA,mBAAA","sourceRoot":"","sourcesContent":["\"use strict\";\n// utility for whatwg streams\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ensureAsyncIterable = exports.asyncIterableFromStream = exports.isAsyncIterable = void 0;\nfunction isAsyncIterable(object) {\n    return object[Symbol.asyncIterator] != null;\n}\nexports.isAsyncIterable = isAsyncIterable;\nfunction assertNonNull(value) {\n    if (value == null) {\n        throw new Error(\"Assertion Failure: value must not be null nor undefined\");\n    }\n}\nasync function* asyncIterableFromStream(stream) {\n    const reader = stream.getReader();\n    try {\n        while (true) {\n            const { done, value } = await reader.read();\n            if (done) {\n                return;\n            }\n            assertNonNull(value);\n            yield value;\n        }\n    }\n    finally {\n        reader.releaseLock();\n    }\n}\nexports.asyncIterableFromStream = asyncIterableFromStream;\nfunction ensureAsyncIterable(streamLike) {\n    if (isAsyncIterable(streamLike)) {\n        return streamLike;\n    }\n    else {\n        return asyncIterableFromStream(streamLike);\n    }\n}\nexports.ensureAsyncIterable = ensureAsyncIterable;\n//# sourceMappingURL=stream.js.map"]},"metadata":{},"sourceType":"script"}